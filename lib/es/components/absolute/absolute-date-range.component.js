function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; subClass.__proto__ = superClass; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _templateObject() {
  var data = _taggedTemplateLiteralLoose(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  width: 100%;\n  padding: 1rem 0 0 0;\n  align-items: center;\n  .form-group {\n    margin-bottom: 0;\n  }\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

function _taggedTemplateLiteralLoose(strings, raw) { if (!raw) { raw = strings.slice(0); } strings.raw = raw; return strings; }

/* eslint-disable jsx-a11y/label-has-for */

/* eslint-disable no-return-assign */
import React from 'react';
import moment from 'moment';
import styled from 'styled-components';
import uuidv4 from 'uuid/v4';
import { DateInput } from '@opuscapita/react-datetime';
import { Content } from '@opuscapita/oc-cm-common-layouts';
import DateSection from '../date-section.components';
import Hyphen from '../hyphen.component';
import propTypes from './prop-types';
import defaultProps from './default-props';
import Overlays from './overlays';
import translate from '../../translations/translate';
var AbsoluteRangeSection = styled.div(_templateObject());

var AbsoluteDateRange =
/*#__PURE__*/
function (_React$PureComponent) {
  _inheritsLoose(AbsoluteDateRange, _React$PureComponent);

  function AbsoluteDateRange(props) {
    var _this;

    _this = _React$PureComponent.call(this, props) || this;

    _defineProperty(_assertThisInitialized(_this), "componentDidMount", function () {
      var showOverlay = _this.props.showOverlay;

      if (_this.from && showOverlay === Overlays.START) {
        _this.from.focus();
      } else if (_this.to && showOverlay === Overlays.END) {
        _this.to.focus();
      }
    });

    _defineProperty(_assertThisInitialized(_this), "handleStartDayClick", function () {
      _this.from = undefined;
    });

    _defineProperty(_assertThisInitialized(_this), "isYearAutoFixed", function (selector, startDate) {
      var inputValue = document.querySelector(selector).value;
      var year = startDate.year();
      var epoch = moment.unix(0).year();
      return year < epoch || !inputValue.includes(year);
    });

    _defineProperty(_assertThisInitialized(_this), "handleStartDateChange", function (date) {
      var startDate = date;
      var from = moment.utc(startDate);
      if (!from.isValid()) return;
      var startDateId = _this.state.startDateId;
      if (_this.isYearAutoFixed(".absolute-start-date #" + startDateId, from)) return;
      var endDate = _this.state.endDate;
      var absoluteRange = {
        startDate: startDate,
        showOverlay: Overlays.START
      };
      var state;

      if (!endDate) {
        state = {
          startDate: startDate,
          absoluteRange: absoluteRange
        };
      } else {
        var to = moment.utc(endDate);

        if (from.isAfter(to)) {
          startDate = endDate;
          from = to;
        }

        state = {
          startDate: startDate,
          endDate: to.endOf('day').toISOString(),
          value: from.format(_this.props.dateFormat) + " - " + to.format(_this.props.dateFormat),
          absoluteRange: _extends({}, absoluteRange, {
            startDate: startDate,
            endDate: endDate
          })
        };
      }

      var disabledEndDays = {
        before: new Date(startDate)
      };

      _this.setState({
        startDate: startDate,
        disabledEndDays: disabledEndDays
      });

      _this.props.onChange(state);
    });

    _defineProperty(_assertThisInitialized(_this), "handleInputChange", function (inputDate, handleChange) {
      var dateFormat = _this.props.dateFormat;
      var utcDate = moment.utc(inputDate, dateFormat, true);

      if (utcDate.isValid()) {
        handleChange(utcDate.toISOString());
      }
    });

    _defineProperty(_assertThisInitialized(_this), "handleInputBlur", function (e, currentValue, handleChange) {
      if (!e) return;
      var dateFormat = _this.props.dateFormat;
      var value = e.target.value;
      var utcDate = value ? moment.utc(value, dateFormat).toISOString() : value;
      if (utcDate !== currentValue) handleChange(utcDate);
    });

    _defineProperty(_assertThisInitialized(_this), "handleEndDayClick", function () {
      _this.to = undefined;
    });

    _defineProperty(_assertThisInitialized(_this), "handleEndDateChange", function (date) {
      var endDate = date;
      var to = moment.utc(endDate);
      if (!to.isValid()) return;
      var endDateId = _this.state.endDateId;
      if (_this.isYearAutoFixed(".absolute-end-date #" + endDateId, to)) return;
      var startDate = _this.state.startDate;
      var absoluteRange = {
        endDate: endDate,
        showOverlay: Overlays.END
      };
      var state;

      if (!startDate) {
        state = {
          endDate: endDate,
          absoluteRange: absoluteRange
        };
      } else {
        var from = moment.utc(startDate);

        if (to.isBefore(from)) {
          endDate = startDate;
          to = from;
        }

        state = {
          startDate: from.startOf('day').toISOString(),
          endDate: to.endOf('day').toISOString(),
          value: from.format(_this.props.dateFormat) + " - " + to.format(_this.props.dateFormat),
          absoluteRange: _extends({}, absoluteRange, {
            endDate: endDate,
            startDate: startDate
          })
        };
      }

      var disabledStartDays = {
        after: new Date(endDate)
      };

      _this.setState({
        endDate: endDate,
        disabledStartDays: disabledStartDays
      });

      _this.props.onChange(state);
    });

    var _this$props = _this.props,
        _startDate = _this$props.startDate,
        _endDate = _this$props.endDate;
    var utcStartDate = moment(_startDate).isValid() ? moment.utc(_startDate).startOf('day').toISOString() : _startDate;
    var utcEndDate = moment(_endDate).isValid() ? moment.utc(_endDate).startOf('day').toISOString() : _endDate;
    utcEndDate = moment(utcStartDate).isValid() && moment(utcEndDate).isValid() && moment(utcEndDate).isBefore(moment(utcStartDate)) ? utcStartDate : utcEndDate;

    var _disabledStartDays = moment(utcEndDate).isValid() ? {
      after: new Date(utcEndDate)
    } : null;

    var _disabledEndDays = moment(utcStartDate).isValid() ? {
      before: new Date(utcStartDate)
    } : null;

    _this.state = {
      startDate: utcStartDate,
      startDateId: "start-date-" + uuidv4(),
      endDate: utcEndDate,
      endDateId: "end-date-" + uuidv4(),
      disabledStartDays: _disabledStartDays,
      disabledEndDays: _disabledEndDays
    };
    return _this;
  }

  var _proto = AbsoluteDateRange.prototype;

  _proto.render = function render() {
    var _this2 = this;

    var _this$props2 = this.props,
        className = _this$props2.className,
        region = _this$props2.region,
        dateFormat = _this$props2.dateFormat,
        numberOfMonths = _this$props2.numberOfMonths,
        showOverlay = _this$props2.showOverlay,
        showWeekNumbers = _this$props2.showWeekNumbers,
        translations = _this$props2.translations;
    var _this$state = this.state,
        disabledEndDays = _this$state.disabledEndDays,
        disabledStartDays = _this$state.disabledStartDays,
        startDate = _this$state.startDate,
        startDateId = _this$state.startDateId,
        endDate = _this$state.endDate,
        endDateId = _this$state.endDateId;
    var handleEndDateChange = this.handleEndDateChange,
        handleStartDateChange = this.handleStartDateChange;
    var from = new Date(startDate);
    var to = new Date(endDate);
    var modifiers = {
      start: from,
      end: to
    };
    return React.createElement(AbsoluteRangeSection, null, React.createElement(DateSection, null, React.createElement(Content.InputColumn, {
      className: "absolute-start-date",
      id: "absoluteStartDate",
      label: translate(translations, 'startDate')
    }, React.createElement(DateInput, {
      className: className + " start-date",
      dateFormat: dateFormat,
      disabledDays: disabledStartDays,
      locale: region,
      modifiers: modifiers,
      numberOfMonths: numberOfMonths,
      onChange: this.handleStartDateChange,
      inputProps: {
        id: startDateId,
        onChange: function onChange(inputDate) {
          return _this2.handleInputChange(inputDate, handleStartDateChange);
        },
        onBlur: function onBlur(e) {
          return _this2.handleInputBlur(e, startDate, handleStartDateChange);
        }
      },
      inputRef: function inputRef(el) {
        return _this2.from = el;
      },
      selectedDays: [from, {
        from: from,
        to: to
      }],
      showClearValue: false,
      showOverlay: showOverlay === Overlays.START,
      showWeekNumbers: showWeekNumbers,
      toMonth: to,
      value: startDate
    }))), React.createElement(Hyphen, null), React.createElement(DateSection, null, React.createElement(Content.InputColumn, {
      className: "absolute-end-date",
      id: "absoluteEndDate",
      label: translate(translations, 'endDate')
    }, React.createElement(DateInput, {
      className: className + " end-date",
      dateFormat: dateFormat,
      disabledDays: disabledEndDays,
      fromMonth: from,
      locale: region,
      modifiers: modifiers,
      month: from,
      numberOfMonths: numberOfMonths,
      onChange: this.handleEndDateChange,
      inputProps: {
        id: endDateId,
        onChange: function onChange(inputDate) {
          return _this2.handleInputChange(inputDate, handleEndDateChange);
        },
        onBlur: function onBlur(e) {
          return _this2.handleInputBlur(e, endDate, handleEndDateChange);
        }
      },
      inputRef: function inputRef(el) {
        return _this2.to = el;
      },
      selectedDays: [from, {
        from: from,
        to: to
      }],
      showClearValue: false,
      showOverlay: showOverlay === Overlays.END,
      showWeekNumbers: showWeekNumbers,
      value: endDate
    }))));
  };

  return AbsoluteDateRange;
}(React.PureComponent);

export { AbsoluteDateRange as default };
AbsoluteDateRange.defaultProps = defaultProps;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2Fic29sdXRlL2Fic29sdXRlLWRhdGUtcmFuZ2UuY29tcG9uZW50LmpzeCJdLCJuYW1lcyI6WyJSZWFjdCIsIm1vbWVudCIsInN0eWxlZCIsInV1aWR2NCIsIkRhdGVJbnB1dCIsIkNvbnRlbnQiLCJEYXRlU2VjdGlvbiIsIkh5cGhlbiIsInByb3BUeXBlcyIsImRlZmF1bHRQcm9wcyIsIk92ZXJsYXlzIiwidHJhbnNsYXRlIiwiQWJzb2x1dGVSYW5nZVNlY3Rpb24iLCJkaXYiLCJBYnNvbHV0ZURhdGVSYW5nZSIsInByb3BzIiwic2hvd092ZXJsYXkiLCJmcm9tIiwiU1RBUlQiLCJmb2N1cyIsInRvIiwiRU5EIiwidW5kZWZpbmVkIiwic2VsZWN0b3IiLCJzdGFydERhdGUiLCJpbnB1dFZhbHVlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidmFsdWUiLCJ5ZWFyIiwiZXBvY2giLCJ1bml4IiwiaW5jbHVkZXMiLCJkYXRlIiwidXRjIiwiaXNWYWxpZCIsInN0YXJ0RGF0ZUlkIiwic3RhdGUiLCJpc1llYXJBdXRvRml4ZWQiLCJlbmREYXRlIiwiYWJzb2x1dGVSYW5nZSIsImlzQWZ0ZXIiLCJlbmRPZiIsInRvSVNPU3RyaW5nIiwiZm9ybWF0IiwiZGF0ZUZvcm1hdCIsImRpc2FibGVkRW5kRGF5cyIsImJlZm9yZSIsIkRhdGUiLCJzZXRTdGF0ZSIsIm9uQ2hhbmdlIiwiaW5wdXREYXRlIiwiaGFuZGxlQ2hhbmdlIiwidXRjRGF0ZSIsImUiLCJjdXJyZW50VmFsdWUiLCJ0YXJnZXQiLCJlbmREYXRlSWQiLCJpc0JlZm9yZSIsInN0YXJ0T2YiLCJkaXNhYmxlZFN0YXJ0RGF5cyIsImFmdGVyIiwidXRjU3RhcnREYXRlIiwidXRjRW5kRGF0ZSIsInJlbmRlciIsImNsYXNzTmFtZSIsInJlZ2lvbiIsIm51bWJlck9mTW9udGhzIiwic2hvd1dlZWtOdW1iZXJzIiwidHJhbnNsYXRpb25zIiwiaGFuZGxlRW5kRGF0ZUNoYW5nZSIsImhhbmRsZVN0YXJ0RGF0ZUNoYW5nZSIsIm1vZGlmaWVycyIsInN0YXJ0IiwiZW5kIiwiaWQiLCJoYW5kbGVJbnB1dENoYW5nZSIsIm9uQmx1ciIsImhhbmRsZUlucHV0Qmx1ciIsImVsIiwiUHVyZUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTtBQUNBLE9BQU9BLEtBQVAsTUFBa0IsT0FBbEI7QUFDQSxPQUFPQyxNQUFQLE1BQW1CLFFBQW5CO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixtQkFBbkI7QUFDQSxPQUFPQyxNQUFQLE1BQW1CLFNBQW5CO0FBRUEsU0FBU0MsU0FBVCxRQUEwQiw0QkFBMUI7QUFDQSxTQUFTQyxPQUFULFFBQXdCLGtDQUF4QjtBQUVBLE9BQU9DLFdBQVAsTUFBd0IsNEJBQXhCO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixxQkFBbkI7QUFDQSxPQUFPQyxTQUFQLE1BQXNCLGNBQXRCO0FBQ0EsT0FBT0MsWUFBUCxNQUF5QixpQkFBekI7QUFDQSxPQUFPQyxRQUFQLE1BQXFCLFlBQXJCO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQiw4QkFBdEI7QUFFQSxJQUFNQyxvQkFBb0IsR0FBR1YsTUFBTSxDQUFDVyxHQUFWLG1CQUExQjs7SUFZcUJDLGlCOzs7OztBQUNuQiw2QkFBWUMsS0FBWixFQUFtQjtBQUFBOztBQUNqQiw0Q0FBTUEsS0FBTjs7QUFEaUIsd0VBc0JDLFlBQU07QUFBQSxVQUNoQkMsV0FEZ0IsR0FDQSxNQUFLRCxLQURMLENBQ2hCQyxXQURnQjs7QUFFeEIsVUFBSSxNQUFLQyxJQUFMLElBQWFELFdBQVcsS0FBS04sUUFBUSxDQUFDUSxLQUExQyxFQUFpRDtBQUMvQyxjQUFLRCxJQUFMLENBQVVFLEtBQVY7QUFDRCxPQUZELE1BRU8sSUFBSSxNQUFLQyxFQUFMLElBQVdKLFdBQVcsS0FBS04sUUFBUSxDQUFDVyxHQUF4QyxFQUE2QztBQUNsRCxjQUFLRCxFQUFMLENBQVFELEtBQVI7QUFDRDtBQUNGLEtB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QUdWTyxRQUFBQSxNQUFNLEVBQUUsZ0JBQUF2QixDQUFDO0FBQUEsaUJBQUksTUFBSSxDQUFDd0IsZUFBTCxDQUFxQnhCLENBQXJCLEVBQXdCZixPQUF4QixFQUFpQytCLG1CQUFqQyxDQUFKO0FBQUE7QUFIQyxPQVZkO0FBZUUsTUFBQSxRQUFRLEVBQUUsa0JBQUFTLEVBQUU7QUFBQSxlQUFLLE1BQUksQ0FBQzNELEVBQUwsR0FBVTJELEVBQWY7QUFBQSxPQWZkO0FBZ0JFLE1BQUEsWUFBWSxFQUFFLENBQUM5RCxJQUFELEVBQU87QUFBRUEsUUFBQUEsSUFBSSxFQUFKQSxJQUFGO0FBQVFHLFFBQUFBLEVBQUUsRUFBRkE7QUFBUixPQUFQLENBaEJoQjtBQWlCRSxNQUFBLGNBQWMsRUFBRSxLQWpCbEI7QUFrQkUsTUFBQSxXQUFXLEVBQUVKLFdBQVcsS0FBS04sUUFBUSxDQUFDVyxHQWxCeEM7QUFtQkUsTUFBQSxlQUFlLEVBQUUrQyxlQW5CbkI7QUFvQkUsTUFBQSxLQUFLLEVBQUU3QjtBQXBCVCxNQUxGLENBREYsQ0EvQkYsQ0FERjtBQWdFRCxHOzs7RUF6TzRDdkMsS0FBSyxDQUFDZ0YsYTs7U0FBaENsRSxpQjtBQThPckJBLGlCQUFpQixDQUFDTCxZQUFsQixHQUFpQ0EsWUFBakMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBqc3gtYTExeS9sYWJlbC1oYXMtZm9yICovXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXR1cm4tYXNzaWduICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgdXVpZHY0IGZyb20gJ3V1aWQvdjQnO1xuXG5pbXBvcnQgeyBEYXRlSW5wdXQgfSBmcm9tICdAb3B1c2NhcGl0YS9yZWFjdC1kYXRldGltZSc7XG5pbXBvcnQgeyBDb250ZW50IH0gZnJvbSAnQG9wdXNjYXBpdGEvb2MtY20tY29tbW9uLWxheW91dHMnO1xuXG5pbXBvcnQgRGF0ZVNlY3Rpb24gZnJvbSAnLi4vZGF0ZS1zZWN0aW9uLmNvbXBvbmVudHMnO1xuaW1wb3J0IEh5cGhlbiBmcm9tICcuLi9oeXBoZW4uY29tcG9uZW50JztcbmltcG9ydCBwcm9wVHlwZXMgZnJvbSAnLi9wcm9wLXR5cGVzJztcbmltcG9ydCBkZWZhdWx0UHJvcHMgZnJvbSAnLi9kZWZhdWx0LXByb3BzJztcbmltcG9ydCBPdmVybGF5cyBmcm9tICcuL292ZXJsYXlzJztcbmltcG9ydCB0cmFuc2xhdGUgZnJvbSAnLi4vLi4vdHJhbnNsYXRpb25zL3RyYW5zbGF0ZSc7XG5cbmNvbnN0IEFic29sdXRlUmFuZ2VTZWN0aW9uID0gc3R5bGVkLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgaGVpZ2h0OiAxMDAlO1xuICB3aWR0aDogMTAwJTtcbiAgcGFkZGluZzogMXJlbSAwIDAgMDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgLmZvcm0tZ3JvdXAge1xuICAgIG1hcmdpbi1ib3R0b206IDA7XG4gIH1cbmA7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFic29sdXRlRGF0ZVJhbmdlIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgc3RhcnREYXRlLCBlbmREYXRlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHV0Y1N0YXJ0RGF0ZSA9IG1vbWVudChzdGFydERhdGUpLmlzVmFsaWQoKSA/IG1vbWVudC51dGMoc3RhcnREYXRlKS5zdGFydE9mKCdkYXknKS50b0lTT1N0cmluZygpIDogc3RhcnREYXRlO1xuICAgIGxldCB1dGNFbmREYXRlID0gbW9tZW50KGVuZERhdGUpLmlzVmFsaWQoKSA/IG1vbWVudC51dGMoZW5kRGF0ZSkuc3RhcnRPZignZGF5JykudG9JU09TdHJpbmcoKSA6IGVuZERhdGU7XG4gICAgdXRjRW5kRGF0ZSA9IG1vbWVudCh1dGNTdGFydERhdGUpLmlzVmFsaWQoKSAmJiBtb21lbnQodXRjRW5kRGF0ZSkuaXNWYWxpZCgpICYmXG4gICAgICBtb21lbnQodXRjRW5kRGF0ZSkuaXNCZWZvcmUobW9tZW50KHV0Y1N0YXJ0RGF0ZSkpID9cbiAgICAgIHV0Y1N0YXJ0RGF0ZSA6XG4gICAgICB1dGNFbmREYXRlO1xuICAgIGNvbnN0IGRpc2FibGVkU3RhcnREYXlzID0gbW9tZW50KHV0Y0VuZERhdGUpLmlzVmFsaWQoKSA/IHsgYWZ0ZXI6IG5ldyBEYXRlKHV0Y0VuZERhdGUpIH0gOiBudWxsO1xuICAgIGNvbnN0IGRpc2FibGVkRW5kRGF5cyA9IG1vbWVudCh1dGNTdGFydERhdGUpLmlzVmFsaWQoKSA/XG4gICAgICB7IGJlZm9yZTogbmV3IERhdGUodXRjU3RhcnREYXRlKSB9IDogbnVsbDtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgc3RhcnREYXRlOiB1dGNTdGFydERhdGUsXG4gICAgICBzdGFydERhdGVJZDogYHN0YXJ0LWRhdGUtJHt1dWlkdjQoKX1gLFxuICAgICAgZW5kRGF0ZTogdXRjRW5kRGF0ZSxcbiAgICAgIGVuZERhdGVJZDogYGVuZC1kYXRlLSR7dXVpZHY0KCl9YCxcbiAgICAgIGRpc2FibGVkU3RhcnREYXlzLFxuICAgICAgZGlzYWJsZWRFbmREYXlzLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCA9ICgpID0+IHtcbiAgICBjb25zdCB7IHNob3dPdmVybGF5IH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICh0aGlzLmZyb20gJiYgc2hvd092ZXJsYXkgPT09IE92ZXJsYXlzLlNUQVJUKSB7XG4gICAgICB0aGlzLmZyb20uZm9jdXMoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMudG8gJiYgc2hvd092ZXJsYXkgPT09IE92ZXJsYXlzLkVORCkge1xuICAgICAgdGhpcy50by5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZVN0YXJ0RGF5Q2xpY2sgPSAoKSA9PiB7XG4gICAgdGhpcy5mcm9tID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaXNZZWFyQXV0b0ZpeGVkID0gKHNlbGVjdG9yLCBzdGFydERhdGUpID0+IHtcbiAgICBjb25zdCBpbnB1dFZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcikudmFsdWU7XG4gICAgY29uc3QgeWVhciA9IHN0YXJ0RGF0ZS55ZWFyKCk7XG4gICAgY29uc3QgZXBvY2ggPSBtb21lbnQudW5peCgwKS55ZWFyKCk7XG4gICAgcmV0dXJuIHllYXIgPCBlcG9jaCB8fCAhaW5wdXRWYWx1ZS5pbmNsdWRlcyh5ZWFyKTtcbiAgfVxuXG4gIGhhbmRsZVN0YXJ0RGF0ZUNoYW5nZSA9IChkYXRlKSA9PiB7XG4gICAgbGV0IHN0YXJ0RGF0ZSA9IGRhdGU7XG4gICAgbGV0IGZyb20gPSBtb21lbnQudXRjKHN0YXJ0RGF0ZSk7XG4gICAgaWYgKCFmcm9tLmlzVmFsaWQoKSkgcmV0dXJuO1xuICAgIGNvbnN0IHsgc3RhcnREYXRlSWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKHRoaXMuaXNZZWFyQXV0b0ZpeGVkKGAuYWJzb2x1dGUtc3RhcnQtZGF0ZSAjJHtzdGFydERhdGVJZH1gLCBmcm9tKSkgcmV0dXJuO1xuXG4gICAgY29uc3QgeyBlbmREYXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGFic29sdXRlUmFuZ2UgPSB7XG4gICAgICBzdGFydERhdGUsXG4gICAgICBzaG93T3ZlcmxheTogT3ZlcmxheXMuU1RBUlQsXG4gICAgfTtcbiAgICBsZXQgc3RhdGU7XG4gICAgaWYgKCFlbmREYXRlKSB7XG4gICAgICBzdGF0ZSA9IHtcbiAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICBhYnNvbHV0ZVJhbmdlLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdG8gPSBtb21lbnQudXRjKGVuZERhdGUpO1xuICAgICAgaWYgKGZyb20uaXNBZnRlcih0bykpIHtcbiAgICAgICAgc3RhcnREYXRlID0gZW5kRGF0ZTtcbiAgICAgICAgZnJvbSA9IHRvO1xuICAgICAgfVxuICAgICAgc3RhdGUgPSB7XG4gICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgZW5kRGF0ZTogdG8uZW5kT2YoJ2RheScpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHZhbHVlOiBgJHtmcm9tLmZvcm1hdCh0aGlzLnByb3BzLmRhdGVGb3JtYXQpfSAtICR7dG8uZm9ybWF0KHRoaXMucHJvcHMuZGF0ZUZvcm1hdCl9YCxcbiAgICAgICAgYWJzb2x1dGVSYW5nZToge1xuICAgICAgICAgIC4uLmFic29sdXRlUmFuZ2UsXG4gICAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICAgIGVuZERhdGUsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBkaXNhYmxlZEVuZERheXMgPSB7IGJlZm9yZTogbmV3IERhdGUoc3RhcnREYXRlKSB9O1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFydERhdGUsIGRpc2FibGVkRW5kRGF5cyB9KTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKHN0YXRlKTtcbiAgfVxuXG4gIGhhbmRsZUlucHV0Q2hhbmdlID0gKGlucHV0RGF0ZSwgaGFuZGxlQ2hhbmdlKSA9PiB7XG4gICAgY29uc3QgeyBkYXRlRm9ybWF0IH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHV0Y0RhdGUgPSBtb21lbnQudXRjKGlucHV0RGF0ZSwgZGF0ZUZvcm1hdCwgdHJ1ZSk7XG4gICAgaWYgKHV0Y0RhdGUuaXNWYWxpZCgpKSB7XG4gICAgICBoYW5kbGVDaGFuZ2UodXRjRGF0ZS50b0lTT1N0cmluZygpKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVJbnB1dEJsdXIgPSAoZSwgY3VycmVudFZhbHVlLCBoYW5kbGVDaGFuZ2UpID0+IHtcbiAgICBpZiAoIWUpIHJldHVybjtcbiAgICBjb25zdCB7IGRhdGVGb3JtYXQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyB2YWx1ZSB9ID0gZS50YXJnZXQ7XG4gICAgY29uc3QgdXRjRGF0ZSA9IHZhbHVlID8gbW9tZW50LnV0Yyh2YWx1ZSwgZGF0ZUZvcm1hdCkudG9JU09TdHJpbmcoKSA6IHZhbHVlO1xuICAgIGlmICh1dGNEYXRlICE9PSBjdXJyZW50VmFsdWUpIGhhbmRsZUNoYW5nZSh1dGNEYXRlKTtcbiAgfVxuXG4gIGhhbmRsZUVuZERheUNsaWNrID0gKCkgPT4ge1xuICAgIHRoaXMudG8gPSB1bmRlZmluZWQ7XG4gIH1cblxuICBoYW5kbGVFbmREYXRlQ2hhbmdlID0gKGRhdGUpID0+IHtcbiAgICBsZXQgZW5kRGF0ZSA9IGRhdGU7XG4gICAgbGV0IHRvID0gbW9tZW50LnV0YyhlbmREYXRlKTtcbiAgICBpZiAoIXRvLmlzVmFsaWQoKSkgcmV0dXJuO1xuICAgIGNvbnN0IHsgZW5kRGF0ZUlkIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmICh0aGlzLmlzWWVhckF1dG9GaXhlZChgLmFic29sdXRlLWVuZC1kYXRlICMke2VuZERhdGVJZH1gLCB0bykpIHJldHVybjtcblxuICAgIGNvbnN0IHsgc3RhcnREYXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGFic29sdXRlUmFuZ2UgPSB7XG4gICAgICBlbmREYXRlLFxuICAgICAgc2hvd092ZXJsYXk6IE92ZXJsYXlzLkVORCxcbiAgICB9O1xuXG4gICAgbGV0IHN0YXRlO1xuICAgIGlmICghc3RhcnREYXRlKSB7XG4gICAgICBzdGF0ZSA9IHtcbiAgICAgICAgZW5kRGF0ZSxcbiAgICAgICAgYWJzb2x1dGVSYW5nZSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZyb20gPSBtb21lbnQudXRjKHN0YXJ0RGF0ZSk7XG4gICAgICBpZiAodG8uaXNCZWZvcmUoZnJvbSkpIHtcbiAgICAgICAgZW5kRGF0ZSA9IHN0YXJ0RGF0ZTtcbiAgICAgICAgdG8gPSBmcm9tO1xuICAgICAgfVxuICAgICAgc3RhdGUgPSB7XG4gICAgICAgIHN0YXJ0RGF0ZTogZnJvbS5zdGFydE9mKCdkYXknKS50b0lTT1N0cmluZygpLFxuICAgICAgICBlbmREYXRlOiB0by5lbmRPZignZGF5JykudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdmFsdWU6IGAke2Zyb20uZm9ybWF0KHRoaXMucHJvcHMuZGF0ZUZvcm1hdCl9IC0gJHt0by5mb3JtYXQodGhpcy5wcm9wcy5kYXRlRm9ybWF0KX1gLFxuICAgICAgICBhYnNvbHV0ZVJhbmdlOiB7XG4gICAgICAgICAgLi4uYWJzb2x1dGVSYW5nZSxcbiAgICAgICAgICBlbmREYXRlLFxuICAgICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IGRpc2FibGVkU3RhcnREYXlzID0geyBhZnRlcjogbmV3IERhdGUoZW5kRGF0ZSkgfTtcbiAgICB0aGlzLnNldFN0YXRlKHsgZW5kRGF0ZSwgZGlzYWJsZWRTdGFydERheXMgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZShzdGF0ZSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2xhc3NOYW1lLFxuICAgICAgcmVnaW9uLFxuICAgICAgZGF0ZUZvcm1hdCxcbiAgICAgIG51bWJlck9mTW9udGhzLFxuICAgICAgc2hvd092ZXJsYXksXG4gICAgICBzaG93V2Vla051bWJlcnMsXG4gICAgICB0cmFuc2xhdGlvbnMsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qge1xuICAgICAgZGlzYWJsZWRFbmREYXlzLFxuICAgICAgZGlzYWJsZWRTdGFydERheXMsXG4gICAgICBzdGFydERhdGUsXG4gICAgICBzdGFydERhdGVJZCxcbiAgICAgIGVuZERhdGUsXG4gICAgICBlbmREYXRlSWQsXG4gICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3Qge1xuICAgICAgaGFuZGxlRW5kRGF0ZUNoYW5nZSxcbiAgICAgIGhhbmRsZVN0YXJ0RGF0ZUNoYW5nZSxcbiAgICB9ID0gdGhpcztcbiAgICBjb25zdCBmcm9tID0gbmV3IERhdGUoc3RhcnREYXRlKTtcbiAgICBjb25zdCB0byA9IG5ldyBEYXRlKGVuZERhdGUpO1xuICAgIGNvbnN0IG1vZGlmaWVycyA9IHsgc3RhcnQ6IGZyb20sIGVuZDogdG8gfTtcbiAgICByZXR1cm4gKFxuICAgICAgPEFic29sdXRlUmFuZ2VTZWN0aW9uPlxuICAgICAgICA8RGF0ZVNlY3Rpb24+XG4gICAgICAgICAgPENvbnRlbnQuSW5wdXRDb2x1bW5cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImFic29sdXRlLXN0YXJ0LWRhdGVcIlxuICAgICAgICAgICAgaWQ9XCJhYnNvbHV0ZVN0YXJ0RGF0ZVwiXG4gICAgICAgICAgICBsYWJlbD17dHJhbnNsYXRlKHRyYW5zbGF0aW9ucywgJ3N0YXJ0RGF0ZScpfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxEYXRlSW5wdXRcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtjbGFzc05hbWV9IHN0YXJ0LWRhdGVgfVxuICAgICAgICAgICAgICBkYXRlRm9ybWF0PXtkYXRlRm9ybWF0fVxuICAgICAgICAgICAgICBkaXNhYmxlZERheXM9e2Rpc2FibGVkU3RhcnREYXlzfVxuICAgICAgICAgICAgICBsb2NhbGU9e3JlZ2lvbn1cbiAgICAgICAgICAgICAgbW9kaWZpZXJzPXttb2RpZmllcnN9XG4gICAgICAgICAgICAgIG51bWJlck9mTW9udGhzPXtudW1iZXJPZk1vbnRoc31cbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlU3RhcnREYXRlQ2hhbmdlfVxuICAgICAgICAgICAgICBpbnB1dFByb3BzPXt7XG4gICAgICAgICAgICAgICAgaWQ6IHN0YXJ0RGF0ZUlkLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBpbnB1dERhdGUgPT4gdGhpcy5oYW5kbGVJbnB1dENoYW5nZShpbnB1dERhdGUsIGhhbmRsZVN0YXJ0RGF0ZUNoYW5nZSksXG4gICAgICAgICAgICAgICAgb25CbHVyOiBlID0+IHRoaXMuaGFuZGxlSW5wdXRCbHVyKGUsIHN0YXJ0RGF0ZSwgaGFuZGxlU3RhcnREYXRlQ2hhbmdlKSxcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgaW5wdXRSZWY9e2VsID0+ICh0aGlzLmZyb20gPSBlbCl9XG4gICAgICAgICAgICAgIHNlbGVjdGVkRGF5cz17W2Zyb20sIHsgZnJvbSwgdG8gfV19XG4gICAgICAgICAgICAgIHNob3dDbGVhclZhbHVlPXtmYWxzZX1cbiAgICAgICAgICAgICAgc2hvd092ZXJsYXk9e3Nob3dPdmVybGF5ID09PSBPdmVybGF5cy5TVEFSVH1cbiAgICAgICAgICAgICAgc2hvd1dlZWtOdW1iZXJzPXtzaG93V2Vla051bWJlcnN9XG4gICAgICAgICAgICAgIHRvTW9udGg9e3RvfVxuICAgICAgICAgICAgICB2YWx1ZT17c3RhcnREYXRlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L0NvbnRlbnQuSW5wdXRDb2x1bW4+XG4gICAgICAgIDwvRGF0ZVNlY3Rpb24+XG4gICAgICAgIDxIeXBoZW4gLz5cbiAgICAgICAgPERhdGVTZWN0aW9uPlxuICAgICAgICAgIDxDb250ZW50LklucHV0Q29sdW1uXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJhYnNvbHV0ZS1lbmQtZGF0ZVwiXG4gICAgICAgICAgICBpZD1cImFic29sdXRlRW5kRGF0ZVwiXG4gICAgICAgICAgICBsYWJlbD17dHJhbnNsYXRlKHRyYW5zbGF0aW9ucywgJ2VuZERhdGUnKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8RGF0ZUlucHV0XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7Y2xhc3NOYW1lfSBlbmQtZGF0ZWB9XG4gICAgICAgICAgICAgIGRhdGVGb3JtYXQ9e2RhdGVGb3JtYXR9XG4gICAgICAgICAgICAgIGRpc2FibGVkRGF5cz17ZGlzYWJsZWRFbmREYXlzfVxuICAgICAgICAgICAgICBmcm9tTW9udGg9e2Zyb219XG4gICAgICAgICAgICAgIGxvY2FsZT17cmVnaW9ufVxuICAgICAgICAgICAgICBtb2RpZmllcnM9e21vZGlmaWVyc31cbiAgICAgICAgICAgICAgbW9udGg9e2Zyb219XG4gICAgICAgICAgICAgIG51bWJlck9mTW9udGhzPXtudW1iZXJPZk1vbnRoc31cbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlRW5kRGF0ZUNoYW5nZX1cbiAgICAgICAgICAgICAgaW5wdXRQcm9wcz17e1xuICAgICAgICAgICAgICAgIGlkOiBlbmREYXRlSWQsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGlucHV0RGF0ZSA9PiB0aGlzLmhhbmRsZUlucHV0Q2hhbmdlKGlucHV0RGF0ZSwgaGFuZGxlRW5kRGF0ZUNoYW5nZSksXG4gICAgICAgICAgICAgICAgb25CbHVyOiBlID0+IHRoaXMuaGFuZGxlSW5wdXRCbHVyKGUsIGVuZERhdGUsIGhhbmRsZUVuZERhdGVDaGFuZ2UpLFxuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICBpbnB1dFJlZj17ZWwgPT4gKHRoaXMudG8gPSBlbCl9XG4gICAgICAgICAgICAgIHNlbGVjdGVkRGF5cz17W2Zyb20sIHsgZnJvbSwgdG8gfV19XG4gICAgICAgICAgICAgIHNob3dDbGVhclZhbHVlPXtmYWxzZX1cbiAgICAgICAgICAgICAgc2hvd092ZXJsYXk9e3Nob3dPdmVybGF5ID09PSBPdmVybGF5cy5FTkR9XG4gICAgICAgICAgICAgIHNob3dXZWVrTnVtYmVycz17c2hvd1dlZWtOdW1iZXJzfVxuICAgICAgICAgICAgICB2YWx1ZT17ZW5kRGF0ZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9Db250ZW50LklucHV0Q29sdW1uPlxuICAgICAgICA8L0RhdGVTZWN0aW9uPlxuICAgICAgPC9BYnNvbHV0ZVJhbmdlU2VjdGlvbj5cbiAgICApO1xuICB9XG59XG5cbkFic29sdXRlRGF0ZVJhbmdlLnByb3BUeXBlcyA9IHByb3BUeXBlcztcblxuQWJzb2x1dGVEYXRlUmFuZ2UuZGVmYXVsdFByb3BzID0gZGVmYXVsdFByb3BzO1xuIl19